<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Lexicon: The Lost Robot Adventure</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', cursive, sans-serif;
      overflow-x: hidden;
    }

    html, body, .main-wrapper {
      height: 100%;
      width: 100%;
    }

    .main-wrapper {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      overflow-y: auto;
      padding: 20px;
    }

    .game-container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .title {
      font-size: 42px;
      color: #667eea;
      margin: 0 0 10px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .subtitle {
      font-size: 18px;
      color: #666;
      margin: 0;
    }

    .progress-bar {
      background: #f0f0f0;
      height: 30px;
      border-radius: 15px;
      margin: 20px 0;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      background: linear-gradient(90deg, #667eea, #764ba2);
      height: 100%;
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    .points-display {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      margin: 20px 0;
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    }

    .chapter-screen {
      display: none;
    }

    .chapter-screen.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .story-box {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      padding: 20px;
      border-radius: 16px;
      margin: 20px 0;
      border-left: 6px solid #f5576c;
    }

    .story-text {
      font-size: 16px;
      line-height: 1.6;
      color: #333;
      margin: 0;
    }

    .activity-box {
      background: #f8f9ff;
      padding: 25px;
      border-radius: 16px;
      margin: 20px 0;
      border: 3px dashed #667eea;
    }

    .activity-title {
      font-size: 24px;
      color: #667eea;
      margin: 0 0 15px 0;
    }

    .question {
      font-size: 18px;
      color: #333;
      margin: 15px 0;
      font-weight: 600;
    }

    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .emoji-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .emoji-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }

    .emoji-card.selected {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .emoji-card.correct {
      border-color: #4ade80;
      background: #f0fdf4;
    }

    .emoji-card.incorrect {
      border-color: #f87171;
      background: #fef2f2;
    }

    .emoji {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .word-option {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .input-word {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      margin: 10px 0;
      font-family: inherit;
      transition: border-color 0.3s ease;
    }

    .input-word:focus {
      outline: none;
      border-color: #667eea;
    }

    .scramble-box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin: 15px 0;
      border: 3px solid #e5e7eb;
    }

    .scrambled {
      font-size: 32px;
      color: #764ba2;
      font-weight: bold;
      letter-spacing: 4px;
      text-align: center;
      margin: 15px 0;
    }

    .hint {
      font-size: 14px;
      color: #666;
      font-style: italic;
      text-align: center;
      margin: 10px 0;
    }

    .choice-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }

    .choice-btn {
      background: white;
      padding: 15px 20px;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      color: #333;
    }

    .choice-btn:hover {
      border-color: #667eea;
      background: #f8f9ff;
      transform: translateY(-2px);
    }

    .choice-btn.selected {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .choice-btn.correct {
      border-color: #4ade80;
      background: #f0fdf4;
    }

    .choice-btn.incorrect {
      border-color: #f87171;
      background: #fef2f2;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 16px 40px;
      border: none;
      border-radius: 50px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      font-family: inherit;
      margin: 10px 5px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    }

    .feedback {
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      display: none;
    }

    .feedback.show {
      display: block;
      animation: bounceIn 0.5s ease;
    }

    @keyframes bounceIn {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }

    .feedback.success {
      background: #f0fdf4;
      color: #22c55e;
      border: 3px solid #4ade80;
    }

    .feedback.error {
      background: #fef2f2;
      color: #f87171;
      border: 3px solid #f87171;
    }

    .celebration {
      text-align: center;
      padding: 40px 20px;
    }

    .celebration-emoji {
      font-size: 120px;
      animation: bounce 1s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .badge {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      color: #764ba2;
      padding: 30px;
      border-radius: 20px;
      margin: 30px auto;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(255, 215, 0, 0.4);
      border: 4px solid #ffa500;
    }

    .badge-title {
      font-size: 32px;
      margin: 10px 0;
      font-weight: bold;
    }

    .badge-subtitle {
      font-size: 18px;
      margin: 10px 0;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
    }

    .match-pair {
      display: flex;
      align-items: center;
      gap: 20px;
      margin: 15px 0;
      padding: 15px;
      background: white;
      border-radius: 12px;
      border: 3px solid #e5e7eb;
    }

    .match-word {
      flex: 1;
      font-size: 20px;
      font-weight: bold;
      color: #667eea;
    }

    .match-select {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-family: inherit;
      cursor: pointer;
    }

    .sentence-builder {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin: 20px 0;
      padding: 20px;
      background: white;
      border-radius: 12px;
      min-height: 60px;
      border: 3px dashed #667eea;
    }

    .sentence-word {
      font-size: 18px;
      color: #333;
      padding: 8px 0;
    }

    .word-blank {
      background: #f8f9ff;
      border: 2px solid #667eea;
      border-radius: 8px;
      padding: 8px 16px;
      min-width: 100px;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      color: #667eea;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: #666;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="main-wrapper">
   <div class="game-container">
    <div class="header">
     <h1 class="title">ğŸ¤– Mission Lexicon ğŸš€</h1>
     <p class="subtitle">Help Lexo the Robot return home!</p>
    </div>
    <div class="points-display">
     â­ Total Points: <span id="totalPoints">0</span> / 100
    </div>
    <div class="progress-bar">
     <div class="progress-fill" id="progressBar" style="width: 0%"><span id="progressText">Chapter 0/10</span>
     </div>
    </div><!-- Welcome Screen -->
    <div id="welcome" class="chapter-screen active">
     <div class="story-box">
      <p class="story-text">ğŸŒŸ <strong>Welcome, Hero!</strong> Lexo the Robot has crash-landed on Earth and needs YOUR help to collect 10 Energy Crystals to power his spaceship home! Each chapter is a mission. Complete all missions to unlock the final crystal and save Lexo! ğŸš€âœ¨</p>
     </div>
     <div class="celebration">
      <div class="celebration-emoji">
       ğŸ¤–
      </div>
      <p style="font-size: 20px; color: #666; margin: 20px 0;">Are you ready to be the hero Lexo needs?</p>
     </div>
     <div class="action-buttons"><button class="btn btn-success" onclick="startAdventure()">ğŸ® Start Adventure</button>
     </div>
    </div><!-- Chapter 1: Emoji Encryption -->
    <div id="chapter1" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸ“ <strong>Chapter 1: Emoji Encryption</strong><br>
        Lexo's map is locked with emoji codes! Match each emoji to the correct word to decrypt the map. Get all 5 correct to earn the first Energy Crystal! ğŸ’</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ” Decrypt the Emoji Map</h3>
      <p class="question">Click on each emoji card and select the matching word:</p>
      <div class="emoji-grid" id="emojiGrid"></div>
      <div class="feedback" id="feedback1"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter1()" id="check1">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(2)" id="next1" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 2: Word Scramble Forest -->
    <div id="chapter2" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸŒ² <strong>Chapter 2: Word Scramble Forest</strong><br>
        The path through the forest is blocked by scrambled words! Unscramble 5 words to clear the path. Each word is worth 2 points! ğŸŒŸ</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ”¤ Unscramble the Words</h3>
      <div id="scrambleContainer"></div>
      <div class="feedback" id="feedback2"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter2()" id="check2">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(3)" id="next2" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 3: Secret Code Sentences -->
    <div id="chapter3" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸª„ <strong>Chapter 3: Secret Code Sentences</strong><br>
        Lexo found a magical spell but words are missing! Fill in the blanks with the correct words to decode the spell. 5 sentences = 10 points! âœ¨</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ”® Complete the Magic Spell</h3>
      <div id="sentenceContainer"></div>
      <div class="feedback" id="feedback3"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter3()" id="check3">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(4)" id="next3" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 4: Synonym Bridge -->
    <div id="chapter4" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸŒ‰ <strong>Chapter 4: Synonym Bridge</strong><br>
        Build the bridge by matching words with their synonyms! Connect 5 pairs correctly to cross safely. Each pair = 2 points! ğŸ¯</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ”— Match the Synonyms</h3>
      <div id="synonymContainer"></div>
      <div class="feedback" id="feedback4"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter4()" id="check4">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(5)" id="next4" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 5: Mini Reading Quest -->
    <div id="chapter5" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸ“– <strong>Chapter 5: Mini Reading Quest</strong><br>
        Read Lexo's diary entry and answer 5 questions to find the treasure key! Each correct answer = 2 points! ğŸ—ï¸</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ“š Read and Answer</h3>
      <div style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid #667eea;">
       <p style="font-size: 16px; line-height: 1.8; color: #333;"><strong>Lexo's Diary:</strong><br><br>
         "Today was <em>incredible</em>! I traveled across three planets before my spaceship crashed on Earth. I met a friendly cat who showed me her favorite park. The trees were tall and green, and children were playing soccer. I tried to eat a sandwich, but robots don't eat food! I miss my home planet, Mechanica, where everything is made of metal and lights. I hope I can return soon with the help of my new human friends."</p>
      </div>
      <div id="readingContainer"></div>
      <div class="feedback" id="feedback5"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter5()" id="check5">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(6)" id="next5" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 6: Grammar Puzzle Cave -->
    <div id="chapter6" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ï¿½ï¿½ï¸ <strong>Chapter 6: Grammar Puzzle Cave</strong><br>
        The cave door will only open with perfect grammar! Choose the correct sentence in each pair. 5 correct = 10 points and the cave opens! ğŸšª</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ“ Choose the Correct Sentence</h3>
      <div id="grammarContainer"></div>
      <div class="feedback" id="feedback6"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter6()" id="check6">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(7)" id="next6" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 7: Antonym Challenge -->
    <div id="chapter7" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">âš¡ <strong>Chapter 7: Antonym Challenge</strong><br>
        The power station needs opposite words to generate energy! Match each word with its antonym to power up Lexo. 5 pairs = 10 points! âš¡</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ”„ Match the Opposites</h3>
      <div id="antonymContainer"></div>
      <div class="feedback" id="feedback7"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter7()" id="check7">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(8)" id="next7" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 8: Verb Tense Tower -->
    <div id="chapter8" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸ—¼ <strong>Chapter 8: Verb Tense Tower</strong><br>
        Climb the tower by choosing the correct verb tense! Each floor needs a different tense. Answer 5 correctly to reach the top! 10 points! ğŸ“ˆ</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">â° Choose the Correct Verb</h3>
      <div id="verbContainer"></div>
      <div class="feedback" id="feedback8"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter8()" id="check8">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(9)" id="next8" style="display: none;">â¡ï¸ Continue Mission</button>
      </div>
     </div>
    </div><!-- Chapter 9: Idiom Island -->
    <div id="chapter9" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸï¸ <strong>Chapter 9: Idiom Island</strong><br>
        The island speaks in idioms! Match each English idiom with its meaning to unlock the secret passage. 5 idioms = 10 points! ğŸ—£ï¸</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ’­ Decode the Idioms</h3>
      <div id="idiomContainer"></div>
      <div class="feedback" id="feedback9"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter9()" id="check9">âœ… Check Answers</button> <button class="btn btn-success" onclick="goToChapter(10)" id="next9" style="display: none;">â¡ï¸ Final Mission!</button>
      </div>
     </div>
    </div><!-- Chapter 10: Final Mission Boss -->
    <div id="chapter10" class="chapter-screen">
     <div class="story-box">
      <p class="story-text">ğŸ† <strong>Chapter 10: Final Mission Boss</strong><br>
        This is it! Use everything you've learned to solve the ultimate puzzle. Combine clues from all chapters to unlock Lexo's spaceship! 5 challenging questions = 10 points! ğŸš€</p>
     </div>
     <div class="activity-box">
      <h3 class="activity-title">ğŸ¯ Final Challenge</h3>
      <div id="finalContainer"></div>
      <div class="feedback" id="feedback10"></div>
      <div class="action-buttons"><button class="btn" onclick="checkChapter10()" id="check10">âœ… Check Answers</button> <button class="btn btn-success" onclick="showVictory()" id="next10" style="display: none;">ğŸ‰ Claim Victory!</button>
      </div>
     </div>
    </div><!-- Victory Screen -->
    <div id="victory" class="chapter-screen">
     <div class="celebration">
      <div class="celebration-emoji">
       ğŸ‰
      </div>
      <h2 style="font-size: 48px; color: #667eea; margin: 20px 0;">MISSION COMPLETE!</h2>
      <p style="font-size: 24px; color: #333; margin: 20px 0;">You did it! Lexo is flying home safely! ğŸš€âœ¨</p>
      <div class="badge">
       <div style="font-size: 80px;">
        ğŸ†
       </div>
       <div class="badge-title">
        MASTER HERO
       </div>
       <div class="badge-subtitle">
        English Learning Champion
       </div>
       <div style="font-size: 32px; margin: 20px 0; font-weight: bold;" id="finalScore">
        100 Points
       </div>
       <div style="font-size: 16px;">
        You collected all 10 Energy Crystals! ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’
       </div>
      </div>
      <p style="font-size: 18px; color: #666; margin: 30px 0;">"Thank you, hero! You're amazing! Keep learning and stay awesome!" - Lexo ğŸ¤–ğŸ’œ</p>
      <div class="action-buttons"><button class="btn btn-secondary" onclick="resetAdventure()">ğŸ”„ Play Again</button>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: "Mission Lexicon",
      robot_name: "Lexo",
      start_button: "Start Adventure",
      check_answer_button: "Check Answer",
      next_chapter_button: "Continue Mission",
      background_color: "#667eea",
      surface_color: "#ffffff",
      text_color: "#333333",
      primary_action_color: "#764ba2",
      secondary_action_color: "#f5576c",
      font_family: "Comic Sans MS",
      font_size: 16
    };

    let currentChapter = 0;
    let totalPoints = 0;
    let completedChapters = new Set();

    // Chapter data
    const chapter1Data = [
      { emoji: "ğŸ•", correct: "pizza", options: ["pizza", "burger", "cake"] },
      { emoji: "ğŸ“š", correct: "book", options: ["book", "pen", "desk"] },
      { emoji: "ğŸŒ§ï¸", correct: "rain", options: ["rain", "snow", "sun"] },
      { emoji: "ğŸ˜Š", correct: "happy", options: ["happy", "sad", "angry"] },
      { emoji: "ğŸƒ", correct: "run", options: ["run", "walk", "jump"] }
    ];

    const chapter2Data = [
      { scrambled: "LOCSHO", answer: "school", hint: "Where you learn" },
      { scrambled: "DREIFN", answer: "friend", hint: "Someone you like" },
      { scrambled: "PPAHY", answer: "happy", hint: "Feeling good" },
      { scrambled: "AMLNAI", answer: "animal", hint: "Living creature" },
      { scrambled: "MSUCI", answer: "music", hint: "Songs and melodies" }
    ];

    const chapter3Data = [
      { sentence: "I ___ to school every day.", answer: "go", options: ["go", "goes", "going"] },
      { sentence: "She ___ a beautiful song yesterday.", answer: "sang", options: ["sing", "sang", "sung"] },
      { sentence: "They are ___ football now.", answer: "playing", options: ["play", "played", "playing"] },
      { sentence: "My cat ___ very fluffy.", answer: "is", options: ["is", "are", "am"] },
      { sentence: "We ___ to the park tomorrow.", answer: "will go", options: ["go", "went", "will go"] }
    ];

    const chapter4Data = [
      { word: "happy", options: ["sad", "joyful", "angry"], correct: "joyful" },
      { word: "big", options: ["small", "large", "tiny"], correct: "large" },
      { word: "quick", options: ["slow", "fast", "lazy"], correct: "fast" },
      { word: "smart", options: ["clever", "silly", "dumb"], correct: "clever" },
      { word: "begin", options: ["end", "start", "finish"], correct: "start" }
    ];

    const chapter5Data = [
      { question: "How many planets did Lexo visit before Earth?", options: ["Two", "Three", "Four"], correct: "Three" },
      { question: "What animal did Lexo meet on Earth?", options: ["Dog", "Cat", "Bird"], correct: "Cat" },
      { question: "What were children playing in the park?", options: ["Basketball", "Soccer", "Tennis"], correct: "Soccer" },
      { question: "What is Lexo's home planet called?", options: ["Robotica", "Mechanica", "Metallica"], correct: "Mechanica" },
      { question: "Why couldn't Lexo eat the sandwich?", options: ["Not hungry", "Robots don't eat", "No time"], correct: "Robots don't eat" }
    ];

    const chapter6Data = [
      { correct: "She goes to school every day.", incorrect: "She go to school every day.", correctAnswer: 0 },
      { correct: "They are playing in the park.", incorrect: "They is playing in the park.", correctAnswer: 0 },
      { correct: "I have finished my homework.", incorrect: "I has finished my homework.", correctAnswer: 0 },
      { correct: "He doesn't like vegetables.", incorrect: "He don't like vegetables.", correctAnswer: 0 },
      { correct: "We were watching a movie.", incorrect: "We was watching a movie.", correctAnswer: 0 }
    ];

    const chapter7Data = [
      { word: "hot", options: ["warm", "cold", "fire"], correct: "cold" },
      { word: "tall", options: ["high", "short", "big"], correct: "short" },
      { word: "easy", options: ["hard", "simple", "nice"], correct: "hard" },
      { word: "empty", options: ["full", "vacant", "hollow"], correct: "full" },
      { word: "dark", options: ["light", "black", "night"], correct: "light" }
    ];

    const chapter8Data = [
      { sentence: "Yesterday, I ___ to the park.", options: ["go", "went", "will go"], correct: "went" },
      { sentence: "Right now, she ___ her homework.", options: ["does", "is doing", "did"], correct: "is doing" },
      { sentence: "Tomorrow, we ___ a movie.", options: ["watch", "watched", "will watch"], correct: "will watch" },
      { sentence: "They ___ soccer every weekend.", options: ["play", "played", "are playing"], correct: "play" },
      { sentence: "Last year, he ___ to London.", options: ["travels", "traveled", "will travel"], correct: "traveled" }
    ];

    const chapter9Data = [
      { idiom: "Break a leg", options: ["Good luck", "Hurt yourself", "Dance well"], correct: "Good luck" },
      { idiom: "Piece of cake", options: ["Dessert", "Very easy", "Birthday"], correct: "Very easy" },
      { idiom: "Hit the books", options: ["Throw books", "Study hard", "Buy books"], correct: "Study hard" },
      { idiom: "Under the weather", options: ["Outside", "Feeling sick", "Raining"], correct: "Feeling sick" },
      { idiom: "Cost an arm and a leg", options: ["Very expensive", "Body parts", "Free"], correct: "Very expensive" }
    ];

    const chapter10Data = [
      { question: "Which word is a synonym for 'begin'?", options: ["Stop", "Start", "End"], correct: "Start" },
      { question: "Choose the correct sentence:", options: ["She don't know", "She doesn't know", "She not know"], correct: "She doesn't know" },
      { question: "Unscramble: VEARB", options: ["Brave", "Bread", "Break"], correct: "Brave" },
      { question: "Complete: I ___ already finished.", options: ["has", "have", "had"], correct: "have" },
      { question: "What does this emoji mean? ğŸ¯", options: ["Target/Goal", "Circle", "Ball"], correct: "Target/Goal" }
    ];

    let chapter1Answers = {};
    let chapter2Answers = {};
    let chapter3Answers = {};
    let chapter4Answers = {};
    let chapter5Answers = {};
    let chapter6Answers = {};
    let chapter7Answers = {};
    let chapter8Answers = {};
    let chapter9Answers = {};
    let chapter10Answers = {};

    function initChapter1() {
      const grid = document.getElementById('emojiGrid');
      grid.innerHTML = '';
      chapter1Data.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'emoji-card';
        card.innerHTML = `
          <div class="emoji">${item.emoji}</div>
          <select class="match-select" id="emoji${index}" onchange="selectEmoji(${index}, this.value)">
            <option value="">Choose...</option>
            ${item.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
          </select>
        `;
        grid.appendChild(card);
      });
    }

    function selectEmoji(index, value) {
      chapter1Answers[index] = value;
    }

    function checkChapter1() {
      let correct = 0;
      chapter1Data.forEach((item, index) => {
        const card = document.querySelectorAll('.emoji-card')[index];
        card.classList.remove('correct', 'incorrect');
        if (chapter1Answers[index] === item.correct) {
          card.classList.add('correct');
          correct++;
        } else if (chapter1Answers[index]) {
          card.classList.add('incorrect');
        }
      });

      const feedback = document.getElementById('feedback1');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸ‰ Perfect! You unlocked the map! +10 points! ğŸ’ Energy Crystal #1 collected!';
        document.getElementById('check1').style.display = 'none';
        document.getElementById('next1').style.display = 'inline-block';
        addPoints(10, 1);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. Try again! You've got this! ğŸ’ª`;
      }
    }

    function initChapter2() {
      const container = document.getElementById('scrambleContainer');
      container.innerHTML = '';
      chapter2Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. Unscramble this word:</p>
          <div class="scrambled">${item.scrambled}</div>
          <p class="hint">ğŸ’¡ Hint: ${item.hint}</p>
          <input type="text" class="input-word" id="scramble${index}" placeholder="Type your answer...">
        `;
        container.appendChild(box);
      });
    }

    function checkChapter2() {
      let correct = 0;
      chapter2Data.forEach((item, index) => {
        const input = document.getElementById(`scramble${index}`);
        const userAnswer = input.value.trim().toLowerCase();
        chapter2Answers[index] = userAnswer;
        if (userAnswer === item.answer) {
          input.style.borderColor = '#4ade80';
          input.style.background = '#f0fdf4';
          correct++;
        } else {
          input.style.borderColor = '#f87171';
          input.style.background = '#fef2f2';
        }
      });

      const feedback = document.getElementById('feedback2');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸŒŸ Excellent! Path cleared! +10 points! ğŸ’ Energy Crystal #2 collected!';
        document.getElementById('check2').style.display = 'none';
        document.getElementById('next2').style.display = 'inline-block';
        addPoints(10, 2);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. Check your spelling and try again! ğŸ”¤`;
      }
    }

    function initChapter3() {
      const container = document.getElementById('sentenceContainer');
      container.innerHTML = '';
      chapter3Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. ${item.sentence}</p>
          <div class="choice-grid">
            ${item.options.map(opt => `
              <button class="choice-btn" onclick="selectSentence(${index}, '${opt}')" data-index="${index}" data-value="${opt}">
                ${opt}
              </button>
            `).join('')}
          </div>
        `;
        container.appendChild(box);
      });
    }

    function selectSentence(index, value) {
      chapter3Answers[index] = value;
      const buttons = document.querySelectorAll(`[data-index="${index}"]`);
      buttons.forEach(btn => {
        btn.classList.remove('selected');
        if (btn.dataset.value === value) {
          btn.classList.add('selected');
        }
      });
    }

    function checkChapter3() {
      let correct = 0;
      chapter3Data.forEach((item, index) => {
        const buttons = document.querySelectorAll(`[data-index="${index}"]`);
        buttons.forEach(btn => {
          btn.classList.remove('correct', 'incorrect');
          if (btn.dataset.value === chapter3Answers[index]) {
            if (chapter3Answers[index] === item.answer) {
              btn.classList.add('correct');
              correct++;
            } else {
              btn.classList.add('incorrect');
            }
          }
        });
      });

      const feedback = document.getElementById('feedback3');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'âœ¨ Magic spell decoded! +10 points! ğŸ’ Energy Crystal #3 collected!';
        document.getElementById('check3').style.display = 'none';
        document.getElementById('next3').style.display = 'inline-block';
        addPoints(10, 3);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. The spell needs perfection! Try again! ğŸª„`;
      }
    }

    function initChapter4() {
      const container = document.getElementById('synonymContainer');
      container.innerHTML = '';
      chapter4Data.forEach((item, index) => {
        const pair = document.createElement('div');
        pair.className = 'match-pair';
        pair.innerHTML = `
          <div class="match-word">${item.word}</div>
          <select class="match-select" id="synonym${index}" onchange="selectSynonym(${index}, this.value)">
            <option value="">Choose synonym...</option>
            ${item.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
          </select>
        `;
        container.appendChild(pair);
      });
    }

    function selectSynonym(index, value) {
      chapter4Answers[index] = value;
    }

    function checkChapter4() {
      let correct = 0;
      chapter4Data.forEach((item, index) => {
        const pair = document.querySelectorAll('.match-pair')[index];
        const select = document.getElementById(`synonym${index}`);
        pair.style.borderColor = '#e5e7eb';
        if (chapter4Answers[index] === item.correct) {
          pair.style.borderColor = '#4ade80';
          pair.style.background = '#f0fdf4';
          correct++;
        } else if (chapter4Answers[index]) {
          pair.style.borderColor = '#f87171';
          pair.style.background = '#fef2f2';
        }
      });

      const feedback = document.getElementById('feedback4');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸŒ‰ Bridge built perfectly! +10 points! ğŸ’ Energy Crystal #4 collected!';
        document.getElementById('check4').style.display = 'none';
        document.getElementById('next4').style.display = 'inline-block';
        addPoints(10, 4);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. The bridge needs stronger connections! ğŸ”—`;
      }
    }

    function initChapter5() {
      const container = document.getElementById('readingContainer');
      container.innerHTML = '';
      chapter5Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. ${item.question}</p>
          <div class="choice-grid">
            ${item.options.map(opt => `
              <button class="choice-btn" onclick="selectReading(${index}, '${opt}')" data-index="${index}" data-value="${opt}">
                ${opt}
              </button>
            `).join('')}
          </div>
        `;
        container.appendChild(box);
      });
    }

    function selectReading(index, value) {
      chapter5Answers[index] = value;
      const buttons = document.querySelectorAll(`[data-index="${index}"]`);
      buttons.forEach(btn => {
        btn.classList.remove('selected');
        if (btn.dataset.value === value) {
          btn.classList.add('selected');
        }
      });
    }

    function checkChapter5() {
      let correct = 0;
      chapter5Data.forEach((item, index) => {
        const buttons = document.querySelectorAll(`[data-index="${index}"]`);
        buttons.forEach(btn => {
          btn.classList.remove('correct', 'incorrect');
          if (btn.dataset.value === chapter5Answers[index]) {
            if (chapter5Answers[index] === item.correct) {
              btn.classList.add('correct');
              correct++;
            } else {
              btn.classList.add('incorrect');
            }
          }
        });
      });

      const feedback = document.getElementById('feedback5');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸ—ï¸ Key found! +10 points! ğŸ’ Energy Crystal #5 collected!';
        document.getElementById('check5').style.display = 'none';
        document.getElementById('next5').style.display = 'inline-block';
        addPoints(10, 5);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. Read carefully and try again! ğŸ“–`;
      }
    }

    function initChapter6() {
      const container = document.getElementById('grammarContainer');
      container.innerHTML = '';
      chapter6Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. Choose the correct sentence:</p>
          <div class="choice-grid">
            <button class="choice-btn" onclick="selectGrammar(${index}, 0)" data-gindex="${index}" data-gvalue="0">
              ${item.correct}
            </button>
            <button class="choice-btn" onclick="selectGrammar(${index}, 1)" data-gindex="${index}" data-gvalue="1">
              ${item.incorrect}
            </button>
          </div>
        `;
        container.appendChild(box);
      });
    }

    function selectGrammar(index, value) {
      chapter6Answers[index] = value;
      const buttons = document.querySelectorAll(`[data-gindex="${index}"]`);
      buttons.forEach(btn => {
        btn.classList.remove('selected');
        if (parseInt(btn.dataset.gvalue) === value) {
          btn.classList.add('selected');
        }
      });
    }

    function checkChapter6() {
      let correct = 0;
      chapter6Data.forEach((item, index) => {
        const buttons = document.querySelectorAll(`[data-gindex="${index}"]`);
        buttons.forEach(btn => {
          btn.classList.remove('correct', 'incorrect');
          if (parseInt(btn.dataset.gvalue) === chapter6Answers[index]) {
            if (chapter6Answers[index] === item.correctAnswer) {
              btn.classList.add('correct');
              correct++;
            } else {
              btn.classList.add('incorrect');
            }
          }
        });
      });

      const feedback = document.getElementById('feedback6');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸšª Cave door opened! +10 points! ğŸ’ Energy Crystal #6 collected!';
        document.getElementById('check6').style.display = 'none';
        document.getElementById('next6').style.display = 'inline-block';
        addPoints(10, 6);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. Grammar must be perfect! ğŸ“`;
      }
    }

    function initChapter7() {
      const container = document.getElementById('finalContainer');
      container.innerHTML = '';
      chapter7Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. ${item.question}</p>
          <div class="choice-grid">
            ${item.options.map(opt => `
              <button class="choice-btn" onclick="selectFinal(${index}, '${opt}')" data-findex="${index}" data-fvalue="${opt}">
                ${opt}
              </button>
            `).join('')}
          </div>
        `;
        container.appendChild(box);
      });
    }

    function selectFinal(index, value) {
      chapter7Answers[index] = value;
      const buttons = document.querySelectorAll(`[data-findex="${index}"]`);
      buttons.forEach(btn => {
        btn.classList.remove('selected');
        if (btn.dataset.fvalue === value) {
          btn.classList.add('selected');
        }
      });
    }

    function initChapter7() {
      const container = document.getElementById('antonymContainer');
      container.innerHTML = '';
      chapter7Data.forEach((item, index) => {
        const pair = document.createElement('div');
        pair.className = 'match-pair';
        pair.innerHTML = `
          <div class="match-word">${item.word}</div>
          <select class="match-select" id="antonym${index}" onchange="selectAntonym(${index}, this.value)">
            <option value="">Choose opposite...</option>
            ${item.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
          </select>
        `;
        container.appendChild(pair);
      });
    }

    function selectAntonym(index, value) {
      chapter7Answers[index] = value;
    }

    function checkChapter7() {
      let correct = 0;
      chapter7Data.forEach((item, index) => {
        const pair = document.querySelectorAll('.match-pair')[index];
        const select = document.getElementById(`antonym${index}`);
        pair.style.borderColor = '#e5e7eb';
        if (chapter7Answers[index] === item.correct) {
          pair.style.borderColor = '#4ade80';
          pair.style.background = '#f0fdf4';
          correct++;
        } else if (chapter7Answers[index]) {
          pair.style.borderColor = '#f87171';
          pair.style.background = '#fef2f2';
        }
      });

      const feedback = document.getElementById('feedback7');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'âš¡ Power station charged! +10 points! ğŸ’ Energy Crystal #7 collected!';
        document.getElementById('check7').style.display = 'none';
        document.getElementById('next7').style.display = 'inline-block';
        addPoints(10, 7);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. Find the true opposites! ğŸ”„`;
      }
    }

    function initChapter8() {
      const container = document.getElementById('verbContainer');
      container.innerHTML = '';
      chapter8Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. ${item.sentence}</p>
          <div class="choice-grid">
            ${item.options.map(opt => `
              <button class="choice-btn" onclick="selectVerb(${index}, '${opt}')" data-vindex="${index}" data-vvalue="${opt}">
                ${opt}
              </button>
            `).join('')}
          </div>
        `;
        container.appendChild(box);
      });
    }

    function selectVerb(index, value) {
      chapter8Answers[index] = value;
      const buttons = document.querySelectorAll(`[data-vindex="${index}"]`);
      buttons.forEach(btn => {
        btn.classList.remove('selected');
        if (btn.dataset.vvalue === value) {
          btn.classList.add('selected');
        }
      });
    }

    function checkChapter8() {
      let correct = 0;
      chapter8Data.forEach((item, index) => {
        const buttons = document.querySelectorAll(`[data-vindex="${index}"]`);
        buttons.forEach(btn => {
          btn.classList.remove('correct', 'incorrect');
          if (btn.dataset.vvalue === chapter8Answers[index]) {
            if (chapter8Answers[index] === item.correct) {
              btn.classList.add('correct');
              correct++;
            } else {
              btn.classList.add('incorrect');
            }
          }
        });
      });

      const feedback = document.getElementById('feedback8');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸ—¼ Tower climbed! +10 points! ğŸ’ Energy Crystal #8 collected!';
        document.getElementById('check8').style.display = 'none';
        document.getElementById('next8').style.display = 'inline-block';
        addPoints(10, 8);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. Check the time clues! â°`;
      }
    }

    function initChapter9() {
      const container = document.getElementById('idiomContainer');
      container.innerHTML = '';
      chapter9Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. "${item.idiom}" means...</p>
          <div class="choice-grid">
            ${item.options.map(opt => `
              <button class="choice-btn" onclick="selectIdiom(${index}, '${opt}')" data-iindex="${index}" data-ivalue="${opt}">
                ${opt}
              </button>
            `).join('')}
          </div>
        `;
        container.appendChild(box);
      });
    }

    function selectIdiom(index, value) {
      chapter9Answers[index] = value;
      const buttons = document.querySelectorAll(`[data-iindex="${index}"]`);
      buttons.forEach(btn => {
        btn.classList.remove('selected');
        if (btn.dataset.ivalue === value) {
          btn.classList.add('selected');
        }
      });
    }

    function checkChapter9() {
      let correct = 0;
      chapter9Data.forEach((item, index) => {
        const buttons = document.querySelectorAll(`[data-iindex="${index}"]`);
        buttons.forEach(btn => {
          btn.classList.remove('correct', 'incorrect');
          if (btn.dataset.ivalue === chapter9Answers[index]) {
            if (chapter9Answers[index] === item.correct) {
              btn.classList.add('correct');
              correct++;
            } else {
              btn.classList.add('incorrect');
            }
          }
        });
      });

      const feedback = document.getElementById('feedback9');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸï¸ Passage unlocked! +10 points! ğŸ’ Energy Crystal #9 collected!';
        document.getElementById('check9').style.display = 'none';
        document.getElementById('next9').style.display = 'inline-block';
        addPoints(10, 9);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. Think about what these phrases really mean! ğŸ’­`;
      }
    }

    function initChapter10() {
      const container = document.getElementById('finalContainer');
      container.innerHTML = '';
      chapter10Data.forEach((item, index) => {
        const box = document.createElement('div');
        box.className = 'scramble-box';
        box.innerHTML = `
          <p class="question">${index + 1}. ${item.question}</p>
          <div class="choice-grid">
            ${item.options.map(opt => `
              <button class="choice-btn" onclick="selectFinal(${index}, '${opt}')" data-findex="${index}" data-fvalue="${opt}">
                ${opt}
              </button>
            `).join('')}
          </div>
        `;
        container.appendChild(box);
      });
    }

    function selectFinal(index, value) {
      chapter10Answers[index] = value;
      const buttons = document.querySelectorAll(`[data-findex="${index}"]`);
      buttons.forEach(btn => {
        btn.classList.remove('selected');
        if (btn.dataset.fvalue === value) {
          btn.classList.add('selected');
        }
      });
    }

    function checkChapter10() {
      let correct = 0;
      chapter10Data.forEach((item, index) => {
        const buttons = document.querySelectorAll(`[data-findex="${index}"]`);
        buttons.forEach(btn => {
          btn.classList.remove('correct', 'incorrect');
          if (btn.dataset.fvalue === chapter10Answers[index]) {
            if (chapter10Answers[index] === item.correct) {
              btn.classList.add('correct');
              correct++;
            } else {
              btn.classList.add('incorrect');
            }
          }
        });
      });

      const feedback = document.getElementById('feedback10');
      if (correct === 5) {
        feedback.className = 'feedback success show';
        feedback.innerHTML = 'ğŸš€ SPACESHIP UNLOCKED! +10 points! ğŸ’ Final Energy Crystal collected!';
        document.getElementById('check10').style.display = 'none';
        document.getElementById('next10').style.display = 'inline-block';
        addPoints(10, 10);
      } else {
        feedback.className = 'feedback error show';
        feedback.innerHTML = `âŒ ${correct}/5 correct. So close! Give it one more try! ğŸ¯`;
      }
    }

    async function addPoints(points, chapter) {
      if (completedChapters.has(chapter)) return;
      
      completedChapters.add(chapter);
      totalPoints += points;
      document.getElementById('totalPoints').textContent = totalPoints;
      
      const progress = (completedChapters.size / 10) * 100;
      document.getElementById('progressBar').style.width = progress + '%';
      document.getElementById('progressText').textContent = `Chapter ${completedChapters.size}/10`;

      if (window.dataSdk) {
        const result = await window.dataSdk.create({
          chapter: chapter,
          completed: true,
          points: points,
          timestamp: new Date().toISOString()
        });
        
        if (!result.isOk) {
          console.error('Failed to save progress');
        }
      }
    }

    function startAdventure() {
      goToChapter(1);
    }

    function goToChapter(num) {
      document.querySelectorAll('.chapter-screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      currentChapter = num;
      document.getElementById(`chapter${num}`).classList.add('active');
      
      if (num === 1 && !document.getElementById('emojiGrid').innerHTML) initChapter1();
      if (num === 2 && !document.getElementById('scrambleContainer').innerHTML) initChapter2();
      if (num === 3 && !document.getElementById('sentenceContainer').innerHTML) initChapter3();
      if (num === 4 && !document.getElementById('synonymContainer').innerHTML) initChapter4();
      if (num === 5 && !document.getElementById('readingContainer').innerHTML) initChapter5();
      if (num === 6 && !document.getElementById('grammarContainer').innerHTML) initChapter6();
      if (num === 7 && !document.getElementById('antonymContainer').innerHTML) initChapter7();
      if (num === 8 && !document.getElementById('verbContainer').innerHTML) initChapter8();
      if (num === 9 && !document.getElementById('idiomContainer').innerHTML) initChapter9();
      if (num === 10 && !document.getElementById('finalContainer').innerHTML) initChapter10();
    }

    function showVictory() {
      document.querySelectorAll('.chapter-screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById('victory').classList.add('active');
      document.getElementById('finalScore').textContent = totalPoints + ' Points';
    }

    function resetAdventure() {
      currentChapter = 0;
      totalPoints = 0;
      completedChapters.clear();
      chapter1Answers = {};
      chapter2Answers = {};
      chapter3Answers = {};
      chapter4Answers = {};
      chapter5Answers = {};
      chapter6Answers = {};
      chapter7Answers = {};
      chapter8Answers = {};
      chapter9Answers = {};
      chapter10Answers = {};
      
      document.getElementById('totalPoints').textContent = '0';
      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('progressText').textContent = 'Chapter 0/10';
      
      document.querySelectorAll('.chapter-screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById('welcome').classList.add('active');
      
      ['check1', 'check2', 'check3', 'check4', 'check5', 'check6', 'check7', 'check8', 'check9', 'check10'].forEach(id => {
        document.getElementById(id).style.display = 'inline-block';
      });
      ['next1', 'next2', 'next3', 'next4', 'next5', 'next6', 'next7', 'next8', 'next9', 'next10'].forEach(id => {
        document.getElementById(id).style.display = 'none';
      });
      
      document.getElementById('emojiGrid').innerHTML = '';
      document.getElementById('scrambleContainer').innerHTML = '';
      document.getElementById('sentenceContainer').innerHTML = '';
      document.getElementById('synonymContainer').innerHTML = '';
      document.getElementById('readingContainer').innerHTML = '';
      document.getElementById('grammarContainer').innerHTML = '';
      document.getElementById('antonymContainer').innerHTML = '';
      document.getElementById('verbContainer').innerHTML = '';
      document.getElementById('idiomContainer').innerHTML = '';
      document.getElementById('finalContainer').innerHTML = '';
    }

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Arial, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.querySelector('.main-wrapper').style.background = `linear-gradient(135deg, ${backgroundColor} 0%, ${primaryColor} 100%)`;
      document.querySelector('.game-container').style.background = surfaceColor;
      document.querySelector('.title').style.color = backgroundColor;
      
      document.querySelectorAll('.story-text, .question, .word-option, .sentence-word').forEach(el => {
        el.style.color = textColor;
        el.style.fontSize = `${baseSize}px`;
      });
      
      document.querySelectorAll('.title').forEach(el => {
        el.style.fontSize = `${baseSize * 2.6}px`;
      });
      
      document.querySelectorAll('.subtitle, .badge-subtitle').forEach(el => {
        el.style.fontSize = `${baseSize * 1.1}px`;
      });
      
      document.querySelectorAll('.activity-title').forEach(el => {
        el.style.fontSize = `${baseSize * 1.5}px`;
        el.style.color = backgroundColor;
      });

      const gameTitle = config.game_title || defaultConfig.game_title;
      const robotName = config.robot_name || defaultConfig.robot_name;
      document.querySelector('.title').textContent = `ğŸ¤– ${gameTitle} ğŸš€`;
      document.querySelector('.subtitle').textContent = `Help ${robotName} the Robot return home!`;
    }

    const dataHandler = {
      onDataChanged(data) {
        // UI updates handled by game logic
      }
    };

    const capabilities = {
      recolorables: [
        {
          get: () => window.elementSdk.config.background_color || defaultConfig.background_color,
          set: (value) => {
            window.elementSdk.config.background_color = value;
            window.elementSdk.setConfig({ background_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.surface_color || defaultConfig.surface_color,
          set: (value) => {
            window.elementSdk.config.surface_color = value;
            window.elementSdk.setConfig({ surface_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.text_color || defaultConfig.text_color,
          set: (value) => {
            window.elementSdk.config.text_color = value;
            window.elementSdk.setConfig({ text_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.primary_action_color || defaultConfig.primary_action_color,
          set: (value) => {
            window.elementSdk.config.primary_action_color = value;
            window.elementSdk.setConfig({ primary_action_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.secondary_action_color || defaultConfig.secondary_action_color,
          set: (value) => {
            window.elementSdk.config.secondary_action_color = value;
            window.elementSdk.setConfig({ secondary_action_color: value });
          }
        }
      ],
      borderables: [],
      fontEditable: {
        get: () => window.elementSdk.config.font_family || defaultConfig.font_family,
        set: (value) => {
          window.elementSdk.config.font_family = value;
          window.elementSdk.setConfig({ font_family: value });
        }
      },
      fontSizeable: {
        get: () => window.elementSdk.config.font_size || defaultConfig.font_size,
        set: (value) => {
          window.elementSdk.config.font_size = value;
          window.elementSdk.setConfig({ font_size: value });
        }
      }
    };

    async function init() {
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }

      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: () => capabilities,
          mapToEditPanelValues: (config) => new Map([
            ["game_title", config.game_title || defaultConfig.game_title],
            ["robot_name", config.robot_name || defaultConfig.robot_name],
            ["start_button", config.start_button || defaultConfig.start_button],
            ["check_answer_button", config.check_answer_button || defaultConfig.check_answer_button],
            ["next_chapter_button", config.next_chapter_button || defaultConfig.next_chapter_button]
          ])
        });
      }
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ac59c88429efc5d',t:'MTc2NTQ2MjcwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
